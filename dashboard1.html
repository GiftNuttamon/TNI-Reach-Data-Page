<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Realtime JSON → CSV + ตาราง + แดชบอร์ด (Firebase)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    .text-mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }
    .nowrap { white-space: nowrap; }
    .table-scroll { max-height: 73vh; overflow: auto; }
    thead th { position: sticky; top: 0; z-index: 5; }
    .bar-track { background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.12); }
    .bar-fill { transition: width .35s ease, background-color .2s ease, transform .15s ease; }
    .bar-item:hover .bar-fill { transform: translateY(-1px); }
    .chip { background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.16); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 via-sky-900 to-cyan-900 text-white">
<div class="max-w-7xl mx-auto px-4 py-8">
<header class="mb-6 flex flex-wrap items-center justify-between gap-3">
<div>
<h1 class="text-3xl md:text-4xl font-bold tracking-tight">Realtime JSON → CSV + แดชบอร์ด (Firebase)</h1>
<p class="text-white/80 mt-2">ดึงข้อมูล inquiries จาก Firebase Realtime Database แบบ Real-time อัปเดตตาราง ดาวน์โหลด CSV และสำรวจด้วยแดชบอร์ดเจาะลึก</p>
</div>
<div class="flex items-center gap-2">
<span class="px-2.5 py-1 rounded-full text-xs bg-white/15 text-white/70" id="connBadge">กำลังเริ่มต้น...</span>
<span class="text-white/60 text-xs" id="lastUpdate"></span>
</div>
</header>
<!-- ปุ่มดาวน์โหลด / คัดลอก -->
<section class="bg-white/10 backdrop-blur rounded-2xl border border-white/10 p-5 md:p-6">
<div class="flex flex-wrap items-center gap-3">
<button class="px-4 py-2 rounded-lg bg-white/15 text-white/60 font-semibold cursor-not-allowed transition" disabled="" id="btnDownload">ดาวน์โหลด CSV</button>
<button class="px-4 py-2 rounded-lg bg-white/15 text-white/60 font-semibold cursor-not-allowed transition" disabled="" id="btnCopy">คัดลอก CSV</button>
<span class="text-white/70 text-sm" id="countInfo"></span>
</div>
</section>
<!-- แดชบอร์ดควบคุม -->
<section class="mt-6 hidden" id="dashControls">
<div class="bg-white/10 backdrop-blur rounded-2xl border border-white/10 p-5 md:p-6">
<div class="flex flex-wrap items-center gap-3">
<span class="text-white/80">เลือกคอลัมน์สำหรับแดชบอร์ด</span>
<select class="bg-white/10 border border-white/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-400/70" id="dashField" style="background-color: blueviolet;">
<option selected="" value="level">ระดับที่สนใจ (level)</option>
<option value="fac">คณะ (fac)</option>
<option value="major">สาขา (major)</option>
<option value="grade">วุฒิการศึกษา (grade)</option>
<option value="country">ประเทศ (country)</option>
<option value="province">จังหวัด (province)</option>
<option value="title">คำนำหน้า (title)</option>
</select>
<button class="px-4 py-2 rounded-lg bg-fuchsia-400 hover:bg-fuchsia-300 text-fuchsia-950 font-semibold transition" id="btnBuildDash">สร้างแดชบอร์ด</button>
<button class="px-4 py-2 rounded-lg bg-white/15 hover:bg-white/25 text-white font-medium transition" id="btnResetDash">ล้างตัวกรองแดชบอร์ด</button>
</div>
<div class="mt-4 text-sm text-white/80" id="dashBreadcrumb"></div>
<p class="mt-2 text-xs text-white/60">คลิกแท่งเพื่อเจาะลึก, คลิก breadcrumb เพื่อย้อนระดับ</p>
</div>
</section>
<!-- พื้นที่แสดงแดชบอร์ด -->
<section class="mt-4 hidden" id="dashSection">
<div class="grid gap-4 md:grid-cols-2" id="dashContainer"></div>
<div class="hidden text-white/70 text-sm mt-2" id="dashEmpty">ไม่มีข้อมูลในแดชบอร์ด</div>
</section>
<!-- ตารางผลลัพธ์ -->
<section class="mt-6 hidden" id="tableSection">
<div class="bg-white/10 backdrop-blur rounded-2xl border border-white/10 overflow-hidden">
<div class="table-scroll">
<table class="min-w-full text-sm">
<thead class="bg-white/10">
<tr>
<th class="text-left px-4 py-3">คำนำหน้า</th>
<th class="text-left px-4 py-3">ชื่อ</th>
<th class="text-left px-4 py-3">นามสกุล</th>
<th class="text-left px-4 py-3">วุฒิการศึกษา</th>
<th class="text-left px-4 py-3">อีเมล</th>
<th class="text-left px-4 py-3">เบอร์โทร</th>
<th class="text-left px-4 py-3">ไอดีไลน์</th>
<th class="text-left px-4 py-3">ประเทศ</th>
<th class="text-left px-4 py-3">จังหวัด</th>
<th class="text-left px-4 py-3">ระดับที่สนใจ</th>
<th class="text-left px-4 py-3">คณะ</th>
<th class="text-left px-4 py-3">สาขา</th>
<th class="text-left px-4 py-3">วันที่-เวลา</th>
</tr>
</thead>
<tbody class="divide-y divide-white/10" id="tableBody"></tbody>
</table>
</div>
</div>
</section>
<footer class="mt-8 text-white/70 text-xs space-y-1">
<p>เวลาเป็นเขตเวลาไทย เบอร์โทรเก็บเป็นข้อความเพื่อไม่ให้ตัดศูนย์นำหน้า และ CSV ป้องกันการตัดเลขใน Excel</p>
<p>คำแนะนำ: ถ้าใช้คีย์จริงบนหน้าเว็บสาธารณะ ควรตั้งกฎ Database ให้เหมาะสม (เช่น read-only)</p>
</footer>
</div>
<!-- Firebase SDK v9+ (Modular) -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getDatabase, ref, onValue, off } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

    // ---------- Firebase Config (ฝังตามที่ให้มา) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyC19fPxfWlWfrLVkTdZ2V8ZUP8jLJhOXko",
      authDomain: "hohoho-6bc89.firebaseapp.com",
      databaseURL: "https://hohoho-6bc89-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "hohoho-6bc89",
      storageBucket: "hohoho-6bc89.firebasestorage.app",
      messagingSenderId: "872473181386",
      appId: "1:872473181386:web:0fe6b9f655f4b1e1258833",
      measurementId: "G-V2EXK83JKK"
    };

    // ---------- เริ่มต้น Firebase ----------
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // ---------- โครงร่างข้อมูลและป้ายภาษาไทย ----------
    const FIELD_ORDER = [
      "title","fname","lname","grade","email","phone","lineid",
      "country","province","level","fac","major","timestamp"
    ];
    const HEADER_TH = [
      "คำนำหน้า","ชื่อ","นามสกุล","วุฒิการศึกษา","อีเมล","เบอร์โทร","ไอดีไลน์",
      "ประเทศ","จังหวัด","ระดับที่สนใจ","คณะ","สาขา","วันที่-เวลา"
    ];
    const LABEL_TH = {
      title: "คำนำหน้า", fname: "ชื่อ", lname: "นามสกุล",
      grade: "วุฒิการศึกษา", email: "อีเมล", phone: "เบอร์โทร", lineid: "ไอดีไลน์",
      country: "ประเทศ", province: "จังหวัด", level: "ระดับที่สนใจ", fac: "คณะ",
      major: "สาขา", timestamp: "วันที่-เวลา"
    };
    const DRILL_MAP = {
      level: ["level","fac","major"],
      fac:   ["fac","major"],
      major: ["major"],
      grade: ["grade"],
      country: ["country","province"],
      province: ["province"],
      title: ["title"],
    };

    // ---------- DOM ----------
    const el = {
      connBadge: document.getElementById('connBadge'),
      lastUpdate: document.getElementById('lastUpdate'),
      btnDownload: document.getElementById('btnDownload'),
      btnCopy: document.getElementById('btnCopy'),
      countInfo: document.getElementById('countInfo'),
      tableSec: document.getElementById('tableSection'),
      tbody: document.getElementById('tableBody'),

      dashControls: document.getElementById('dashControls'),
      dashField: document.getElementById('dashField'),
      btnBuildDash: document.getElementById('btnBuildDash'),
      btnResetDash: document.getElementById('btnResetDash'),
      dashSection: document.getElementById('dashSection'),
      dashContainer: document.getElementById('dashContainer'),
      dashEmpty: document.getElementById('dashEmpty'),
      dashBreadcrumb: document.getElementById('dashBreadcrumb'),
    };

    // ---------- State ----------
    let currentRows = []; // ข้อมูลทั้งหมดที่ดึงมาจาก Firebase
    let currentFilteredRows = []; // ข้อมูลที่ถูกกรองด้วยแดชบอร์ด (แสดงในตาราง)
    let currentFilteredCSV = ""; // CSV จากข้อมูลที่ถูกกรอง
    let dashStart = 'level';
    let dashFilters = {};
    let currentRef = null;

    // ---------- Helpers ----------
    function setConnBadge(state, text) {
      if (state === "connected") {
        el.connBadge.textContent = text || "เชื่อมต่ออยู่ (Real-time)";
        el.connBadge.className = "px-2.5 py-1 rounded-full text-xs bg-emerald-400/90 text-emerald-950";
      } else if (state === "connecting") {
        el.connBadge.textContent = text || "กำลังเชื่อมต่อ...";
        el.connBadge.className = "px-2.5 py-1 rounded-full text-xs bg-amber-400/90 text-amber-950";
      } else {
        el.connBadge.textContent = text || "ยังไม่เชื่อมต่อ";
        el.connBadge.className = "px-2.5 py-1 rounded-full text-xs bg-white/15 text-white/70";
      }
    }
    function setLastUpdate(date = new Date()) {
      el.lastUpdate.textContent = `อัปเดตล่าสุด: ${date.toLocaleString('th-TH')}`;
    }
    function enableExportButtons(enable) {
      if (enable) {
        el.btnDownload.disabled = false;
        el.btnCopy.disabled = false;
        el.btnDownload.className = "px-4 py-2 rounded-lg bg-emerald-400 hover:bg-emerald-300 text-emerald-950 font-semibold transition";
        el.btnCopy.className = "px-4 py-2 rounded-lg bg-white/15 hover:bg-white/25 text-white font-semibold transition";
      } else {
        el.btnDownload.disabled = true;
        el.btnCopy.disabled = true;
        el.btnDownload.className = "px-4 py-2 rounded-lg bg-white/15 text-white/60 font-semibold cursor-not-allowed transition";
        el.btnCopy.className = "px-4 py-2 rounded-lg bg-white/15 text-white/60 font-semibold cursor-not-allowed transition";
      }
    }
    function safeGet(obj, key) {
      const v = obj && obj[key];
      return (v === null || v === undefined) ? "" : String(v);
    }
    // รองรับ timestamp เป็น ms, s, หรือ string/ISO; ข้าม serverTimestamp placeholder (object)
    function formatTimestamp(value) {
      if (value === null || value === undefined) return "";
      if (typeof value === "object") return "";
      let date = null;
      if (typeof value === "number") {
        const s = String(value);
        date = s.length >= 13 ? new Date(value) : new Date(value * 1000);
      } else if (typeof value === "string") {
        const trimmed = value.trim();
        if (!trimmed) return "";
        if (/^\d{10,}$/.test(trimmed)) {
          date = trimmed.length >= 13 ? new Date(parseInt(trimmed,10)) : new Date(parseInt(trimmed,10)*1000);
        } else {
          const parsed = Date.parse(trimmed);
          if (!isNaN(parsed)) date = new Date(parsed);
        }
      }
      if (!date || isNaN(date.getTime())) return "";
      return date.toLocaleString('th-TH', {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }
    function normalizeRow(raw) {
      const row = {};
      row.title   = safeGet(raw, "title");
      row.fname   = safeGet(raw, "fname");
      row.lname   = safeGet(raw, "lname");
      row.grade   = safeGet(raw, "grade");
      row.email   = safeGet(raw, "email");
      row.phone   = safeGet(raw, "phone"); // เก็บเป็นข้อความเสมอ เพื่อไม่ให้ตัดศูนย์นำหน้า
      row.lineid  = safeGet(raw, "lineid");
      row.country = safeGet(raw, "country");
      row.province= safeGet(raw, "province");
      row.level   = safeGet(raw, "level");
      row.fac     = safeGet(raw, "fac");
      row.major   = safeGet(raw, "major");
      const tsRaw = (raw && "timestamp" in raw) ? raw.timestamp : "";
      row.timestamp = formatTimestamp(tsRaw);
      return row;
    }
    function csvEscape(value) {
      let s = String(value ?? "");
      const mustQuote = /[",\n\r]/.test(s);
      s = s.replace(/"/g, '""');
      return mustQuote ? `"${s}"` : s;
    }
    // CSV โดยป้องกันเบอร์โทรไม่ให้ถูกตัดใน Excel ด้วย ="..."
    function toCSV(rows) {
      // ให้ CSV เหมือนตารางที่แสดง: ใช้ค่าหลัง format เหมือนใน cell
      // ปกป้องเบอร์โทรใน Excel แต่ให้หน้าตาเหมือนบนเว็บ ด้วย ' นำหน้า (ไม่แสดงใน Excel)
      const lines = [];
      lines.push(HEADER_TH.map(csvEscape).join(","));
      for (const r of rows) {
        const fields = FIELD_ORDER.map(k => {
          let v = r[k] ?? "";
          // ใส่เครื่องหมาย ' นำหน้าเบอร์โทร เพื่อป้องกัน Excel ตัดศูนย์นำหน้า
          if (k === "phone" && v !== "") v = "'" + String(v);
          return csvEscape(v);
        });
        lines.push(fields.join(","));
      }
      return "\uFEFF" + lines.join("\r\n");
    }
    function renderTable(rows) {
      el.tbody.innerHTML = "";
      const frag = document.createDocumentFragment();
      for (const r of rows) {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-white/5";
        const cells = [
          r.title, r.fname, r.lname, r.grade, r.email,
          r.phone, r.lineid, r.country, r.province,
          r.level, r.fac, r.major, r.timestamp
        ];
        cells.forEach((text, idx) => {
          const td = document.createElement("td");
          if (HEADER_TH[idx] === "เบอร์โทร") td.className = "px-4 py-3 text-mono nowrap";
          else if (HEADER_TH[idx] === "วันที่-เวลา") td.className = "px-4 py-3 nowrap";
          else td.className = "px-4 py-3";
          td.textContent = text || "";
          tr.appendChild(td);
        });
        frag.appendChild(tr);
      }
      el.tbody.appendChild(frag);
      el.tableSec.classList.toggle("hidden", rows.length === 0);
      el.countInfo.textContent = rows.length ? `จำนวนรายการ: ${rows.length.toLocaleString('th-TH')}` : "";
    }

    // ---------- แดชบอร์ด ----------
    
    function filteredRowsByFilters(rows, filters) {
      const keys = Object.keys(filters);
      if (!keys.length) return rows;
      return rows.filter(r => keys.every(k => (r[k] ?? "") === filters[k]));
    }
    function groupCounts(rows, field) {
      const counts = new Map();
      for (const r of rows) {
        const key = (r[field] ?? "").trim() || "(ว่าง)";
        counts.set(key, (counts.get(key) || 0) + 1);
      }
      return Array.from(counts.entries()).sort((a,b) => b[1]-a[1]);
    }
    function renderBreadcrumb(pathFields, filters) {
      if (!pathFields.length) { el.dashBreadcrumb.innerHTML = ""; return; }
      const parts = [];
      parts.push(`<span class="text-white/70">เจาะลึก: </span>`);
      pathFields.forEach((f, idx) => {
        const label = LABEL_TH[f] || f;
        const val = filters[f];
        if (val) {
          parts.push(`<button data-bc="${f}" class="chip px-2 py-1 rounded-md hover:bg-white/20">${label}: ${escapeHTML(val)} ✕</button>`);
        } else {
          parts.push(`<span class="text-white/60">${label}</span>`);
        }
        if (idx < pathFields.length-1) parts.push(`<span class="text-white/40"> › </span>`);
      });
      el.dashBreadcrumb.innerHTML = parts.join(" ");
      el.dashBreadcrumb.querySelectorAll('button[data-bc]').forEach(btn => {
        btn.addEventListener('click', () => {
          const f = btn.getAttribute('data-bc');
          const path = DRILL_MAP[dashStart] || [dashStart];
          const idx = path.indexOf(f);
          // ลบตัวกรองทั้งหมดตั้งแต่จุดที่คลิกไปจนถึงปลายสุด
          for (let i = idx; i < path.length; i++) delete dashFilters[path[i]];
          buildDashboard();
        });
      });
    }

    /**
     * สร้างแดชบอร์ด อัปเดตตาราง และสร้าง CSV จากข้อมูลที่ถูกกรอง
     */
    function buildDashboard() {
      const dataRows = currentRows || [];
      const hasData = dataRows.length > 0;
      
      // 1. กรองข้อมูลตาม DashFilters
      const filtered = filteredRowsByFilters(dataRows, dashFilters);
      
      // 2. อัปเดต Global State สำหรับข้อมูลที่แสดงในปัจจุบันและ CSV สำหรับ Export
      currentFilteredRows = filtered;
      currentFilteredCSV = toCSV(filtered);

      // 3. อัปเดตตารางและสถานะปุ่ม Export
      renderTable(filtered);
      enableExportButtons(filtered.length > 0); // เปิด/ปิดปุ่มตามจำนวนรายการที่ถูกกรอง
      
      el.dashControls.classList.toggle('hidden', !hasData);
      el.dashSection.classList.toggle('hidden', !hasData);
      if (!hasData) return;

      const path = DRILL_MAP[dashStart] || [dashStart];
      el.dashContainer.innerHTML = "";
      renderBreadcrumb(path, dashFilters);

      // 4. สร้าง Panel แดชบอร์ด
      for (let i = 0; i < path.length; i++) {
        const field = path[i];
        // คำนวณ Counts จากชุดข้อมูลที่ถูกกรองในปัจจุบัน
        const rowsAtThisStage = filteredRowsByFilters(dataRows, dashFilters);
        const entries = groupCounts(rowsAtThisStage, field);
        const panel = createPanel(field, entries, rowsAtThisStage.length);
        el.dashContainer.appendChild(panel);
      }
    }
    
    function createPanel(field, entries, total) {
      const label = LABEL_TH[field] || field;
      const wrap = document.createElement('div');
      wrap.className = "bg-white/10 backdrop-blur rounded-2xl border border-white/10 p-4";

      const title = document.createElement('div');
      title.className = "flex items-center justify-between mb-3";
      title.innerHTML = `<div class="font-semibold">${label} <span class="text-white/60 text-sm">(รวม ${total.toLocaleString('th-TH')} รายการ)</span></div>`;
      wrap.appendChild(title);

      const list = document.createElement('div');
      list.className = "space-y-2";

      if (!entries.length) {
        const empty = document.createElement('div');
        empty.className = 'text-white/70 text-sm';
        empty.textContent = 'ไม่มีข้อมูลสำหรับชั้นนี้';
        list.appendChild(empty);
        wrap.appendChild(list);
        return wrap;
      }

      const max = entries[0][1];
      entries.forEach(([name, count]) => {
        const header = document.createElement('div');
        header.className = "flex items-center justify-between text-sm";
        header.innerHTML = `<span class="truncate pr-3">${escapeHTML(name)}</span><span class="font-semibold">${count.toLocaleString('th-TH')}</span>`;

        const track = document.createElement('div');
        track.className = "bar-track rounded-lg overflow-hidden";
        const fill = document.createElement('div');
        const pct = max ? Math.max(4, Math.round((count / max) * 100)) : 0;
        fill.className = `bar-fill h-8 ${dashFilters[field] === name ? 'bg-fuchsia-400 text-fuchsia-950' : 'bg-cyan-400/90'}`;
        fill.style.width = pct + '%';

        const item = document.createElement('button');
        item.type = 'button';
        item.className = "bar-item w-full text-left group";
        item.setAttribute('data-field', field);
        item.setAttribute('data-value', name);

        track.appendChild(fill);
        item.appendChild(header);
        item.appendChild(track);
        list.appendChild(item);

        item.addEventListener('click', () => onBarClick(field, name));
      });

      wrap.appendChild(list);
      return wrap;
    }
    function onBarClick(field, value) {
      const path = DRILL_MAP[dashStart] || [dashStart];
      dashFilters[field] = value;
      const idx = path.indexOf(field);
      // ลบตัวกรองในระดับที่ต่ำกว่าออก เพื่อให้เจาะลึกใหม่
      if (idx >= 0) for (let i = idx + 1; i < path.length; i++) delete dashFilters[path[i]];
      buildDashboard();
    }
    function escapeHTML(s) {
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
    }

    // ---------- Realtime: subscribe inquiries ----------
    function subscribeRealtime() {
      setConnBadge("connecting");
      const path = "inquiries";
      if (currentRef) off(currentRef);
      const r = ref(db, path);
      currentRef = r;

      onValue(r, (snap) => {
        const data = snap.val() || {};
        const rows = [];
        Object.keys(data).forEach(k => {
          const item = data[k];
          if (item && typeof item === "object") rows.push(normalizeRow(item));
        });
        
        // อัปเดตข้อมูลดิบ และเรียก buildDashboard เพื่อจัดการการกรอง/แสดงผล/สร้าง CSV
        currentRows = rows;
        setLastUpdate(new Date());
        setConnBadge("connected");
        
        // เรียก buildDashboard เพื่อแสดงผลตารางที่ถูกกรองและสร้าง CSV จากข้อมูลนั้น
        buildDashboard(); 
        
      }, (error) => {
        console.error(error);
        setConnBadge("idle", "เชื่อมต่อผิดพลาด");
      });
    }

    // ---------- Events ----------
    document.getElementById('btnDownload').addEventListener("click", () => {
      // ใช้ CSV ที่ถูกกรองแล้ว
      if (!currentFilteredCSV) return;
      try {
        const blob = new Blob([currentFilteredCSV], { type: "text/csv;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        const ts = new Date().toISOString().replace(/[:.]/g, "-");
        a.href = url;
        a.download = `inquiries-filtered-${ts}.csv`;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          a.remove();
          URL.revokeObjectURL(url);
        }, 0);
      } catch {}
    });
    document.getElementById('btnCopy').addEventListener("click", async () => {
      // ใช้ CSV ที่ถูกกรองแล้ว
      if (!currentFilteredCSV) return;
      try {
        await navigator.clipboard.writeText(currentFilteredCSV);
        el.connBadge.textContent = "คัดลอก CSV แล้ว";
      } catch {}
    });
    document.getElementById('btnBuildDash').addEventListener('click', () => {
      dashFilters = {};
      dashStart = el.dashField.value || 'level';
      buildDashboard();
    });
    document.getElementById('btnResetDash').addEventListener('click', () => {
      dashFilters = {};
      buildDashboard();
    });

    // เริ่มเชื่อมต่อทันทีเมื่อโหลดหน้า
    subscribeRealtime();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980d60a106bb5805',t:'MTc1ODE2MjE2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
